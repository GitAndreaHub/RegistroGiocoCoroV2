<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Prototype GiocoCoro UI</title>
  <!-- Tailwind CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Poppins', sans-serif; background: #f9f9f9; margin: 0; }
    #root { max-width: 600px; margin: auto; padding: 1rem; }
    .header { background: linear-gradient(90deg,#ec4899,#db2777); color:#fff; padding:1rem; border-radius:0.5rem; text-align:center; }
    .nav-btn { flex:1; padding:0.5rem; font-weight:600; }
    .nav-active { border-b-2 border-white; }
    .input-group { display:flex; gap:0.5rem; margin-bottom:1rem; }
    input[type="date"], input[type="text"], input[type="month"] {
      flex:1; padding:0.5rem 0.75rem; border:1px solid #d1d5db; border-radius:0.375rem;
    }
    .btn-add { background:#db2777; color:#fff; padding:0.6rem 1.2rem; border-radius:0.375rem; font-weight:600; }
    .btn-add:active { transform:scale(0.98); }
    .student-item { background:#fff; display:flex; justify-content:space-between; align-items:center; padding:1rem; margin-bottom:1rem; border-radius:0.5rem; box-shadow:0 2px 8px rgba(0,0,0,0.05); animation:slideDown 0.3s ease; }
    .status-btn { min-width:6rem; padding:0.5rem; border-radius:9999px; font-weight:600; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
    .status-btn.default { background:#e5e7eb; color:#374151; }
    .status-btn.present { background:#10b981; color:#fff; }
    .status-btn.absent { background:#ef4444; color:#fff; }
    .delete-btn { background:none; border:none; color:#e11d48; font-size:1.25rem; }
    .delete-btn:hover { background:#fee2e2; border-radius:0.375rem; }
    .stats-btn { width:100%; background:#f59e0b; color:#fff; padding:0.75rem; font-weight:600; border-radius:0.375rem; margin-bottom:1rem; }
    .stats-container { overflow:hidden; transition:max-height 0.3s ease; }
    .stats-collapsed { max-height:0; }
    .stats-expanded { max-height:200px; }
    table { width:100%; border-collapse:collapse; margin-top:0.5rem; }
    th,td { padding:0.5rem; border-bottom:1px solid #e5e7eb; text-align:left; }
    th { background:#fce7f3; }
    @keyframes slideDown { from{opacity:0;transform:translateY(-10px);}to{opacity:1;transform:translateY(0);} }
  </style>
</head>
<body>
  <div id="root"></div>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>
  <script>
    // Firebase init
    const firebaseConfig = {
      apiKey: "AIzaSyA4TzdjNP4roonlqd9Pz5Nebs7Q2xQjcOo",
      authDomain: "registro-giococoro-v2.firebaseapp.com",
      projectId: "registro-giococoro-v2",
      storageBucket: "registro-giococoro-v2.firebasestorage.app",
      messagingSenderId: "241025435819",
      appId: "1:241025435819:web:081adbe21b592a0eda8fee"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  </script>
  <script>
    (function() {
      const { useState, useEffect } = React;
      function App() {
        const today = new Date().toISOString().split('T')[0];
        const currentMonth = today.slice(0,7);
        const [view, setView] = useState('daily');
        const [date, setDate] = useState(today);
        const [month, setMonth] = useState(currentMonth);
        const [students, setStudents] = useState([]);
        const [attendance, setAttendance] = useState({});
        const [newName, setNewName] = useState('');
        const [showStats, setShowStats] = useState(false);
        useEffect(() => {
          db.collection('students').get().then(snap=>{
            setStudents(snap.docs.map(d=>d.data().name));
          });
        }, []);
        useEffect(() => {
          if(!attendance[date]){
            const init = {};
            students.forEach(n=>init[n]=null);
            setAttendance(prev=>({...prev,[date]:init}));
          }
        }, [date,students]);
        const toggleStatus = name =>{
          setAttendance(prev=>{
            const day={...prev[date]};
            const cur=day[name];
            day[name]=cur===null?true:cur===true?false:null;
            return {...prev,[date]:day};
          });
        };
        const addStudent = () => {
          const n=newName.trim(); if(!n) return;
          db.collection('students').add({name:n}).then(()=>{
            setStudents(prev=>[...prev,n]);setNewName('');
          });
        };
        const deleteStudent = n => {
          db.collection('students').where('name','==',n).get().then(snap=>{
            snap.forEach(doc=>doc.ref.delete());
            setStudents(prev=>prev.filter(x=>x!==n));
          });
        };
        const dayRec=attendance[date]||{};
        const presentCount=Object.values(dayRec).filter(v=>v===true).length;
        const absentCount=Object.values(dayRec).filter(v=>v===false).length;
        const monthDates=Object.keys(attendance).filter(d=>d.startsWith(month));
        const stats=students.map(n=>{
          let pres=0,abs=0;
          monthDates.forEach(d=>{const v=attendance[d]?.[n];if(v===true) pres++;else if(v===false) abs++;});
          return {name:n,presenze:pres,assenze:abs};
        });
        return React.createElement('div', {},
          React.createElement('div',{className:'header'},
            React.createElement('h1',null,'GiocoCoro'),
            React.createElement('div',{className:'flex'},
              React.createElement('button',{className:`nav-btn ${view==='daily'?'nav-active':''}`,onClick:()=>setView('daily')},'Giornaliera'),
              React.createElement('button',{className:`nav-btn ${view==='monthly'?'nav-active':''}`,onClick:()=>setView('monthly')},'Mensile')
            )
          ),
          view==='daily' && React.createElement('div',{},
            React.createElement('div',{className:'input-group'},
              React.createElement('input',{type:'date',value:date,onChange:e=>setDate(e.target.value)}),
              React.createElement('input',{type:'text',value:newName,placeholder:'Nuovo studente',onChange:e=>setNewName(e.target.value)}),
              React.createElement('button',{className:'btn-add',onClick:addStudent},'Aggiungi')
            ),
            students.map(n=>React.createElement('div',{key:n,className:'student-item'},
              React.createElement('span',null,n),
              React.createElement('div',{},
                React.createElement('button',{className:`status-btn ${dayRec[n]===true?'present':'default'}`},dayRec[n]===true?'Presente':dayRec[n]===false?'Assente':'Non definito'),
                React.createElement('button',{className:'delete-btn',onClick:()=>deleteStudent(n)},'Ã—')
              )
            )),
            React.createElement('button',{className:'stats-btn',onClick:()=>setShowStats(s=>!s)},showStats?'Nascondi Statistiche':'Mostra Statistiche'),
            React.createElement('div',{className:`stats-container ${showStats?'stats-expanded':'stats-collapsed'}`},
              React.createElement('p',null,`Presenti: ${presentCount}`),
              React.createElement('p',null,`Assenti: ${absentCount}`),
              React.createElement('p',null,`Iscritti: ${students.length}`)
            )
          ),
          view==='monthly' && React.createElement('div',{},
            React.createElement('div',{className:'input-group'},
              React.createElement('input',{type:'month',value:month,onChange:e=>setMonth(e.target.value)})
            ),
            React.createElement('table',null,
              React.createElement('thead',null,
                React.createElement('tr',null,
                  React.createElement('th',null,'Nome'),
                  React.createElement('th',null,'Presenze'),
                  React.createElement('th',null,'Assenze')
                )
              ),
              React.createElement('tbody',null,
                stats.map(r=>React.createElement('tr',{key:r.name},
                  React.createElement('td',null,r.name),
                  React.createElement('td',null,r.presenze),
                  React.createElement('td',null,r.assenze)
                ))
              )
            )
          )
        );
      }
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(React.createElement(App));
    })();
  </script>
  <script>
    if('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js');
  </script>
</body>
</html>
